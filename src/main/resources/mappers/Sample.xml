<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thekiban.Mapper.SampleMapper">

    <!-- 시교자원 목록 조회 -->
    <select id="SelectSampleList" resultType="Sample">
        SELECT *
        FROM sample
    </select>

    <!-- 시교자원 등록 -->
    <insert id="InsertSample" parameterType="Sample">
        INSERT INTO sample
        (sample_id, sample_code, sample_name, sample_country, sample_type,
        sample_mate, sample_seed, sample_amount, sample_sprout, sample_purity,
        sample_comment, create_date, modify_date)
        VALUES (#{sample_id}, #{sample_code}, #{sample_name}, #{sample_country}, #{sample_type},
        #{sample_mate}, #{sample_seed}, #{sample_amount}, #{sample_sprout}, #{sample_purity},
        #{sample_comment}, NOW(), NOW())
        <selectKey resultType="int" keyProperty="sample_id" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 시교자원 등록 -->
    <insert id="InsertSampleOutcome" parameterType="SampleOutcome">
        INSERT INTO sampleOutcome
        (sample_outcome_id, sample_name, sample_outcome_code, sample_outcome_num, sample_outcome_amount, sample_outcome_in, sample_outcome_out, sample_outcome_remain,
        sample_outcome_person,
        sample_outcome_reciever, sample_outcome_date, sample_outcome_end, sample_outcome_country, sample_outcome_place)
        VALUES (#{sample_outcome_id}, #{sample_name}, #{sample_outcome_code}, #{sample_outcome_num}, #{sample_outcome_amount}, #{sample_outcome_in},
        #{sample_outcome_out}, #{sample_outcome_remain}, #{sample_outcome_person}, #{sample_outcome_reciever}, #{sample_outcome_date},
        #{sample_outcome_end}, #{sample_outcome_country}, #{sample_outcome_place})
        <selectKey resultType="int" keyProperty="sample_outcome_id" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 시교자원 개수 -->
    <select id="SelectSampleCount" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM sample
        <choose>
            <when test="sample_name != 'none'">
                WHERE sample_name = #{sample_name}
            </when>
        </choose>
    </select>

    <!-- 시교자원 검색 -->
    <select id="SearchSample" resultType="Sample">
        SELECT * FROM sample
        <choose>
            <when test="sample_name != 'none'">
                WHERE sample_name = #{sample_name}
                ORDER BY sample_id DESC
            </when>
        </choose>
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 출고자원 개수 -->
    <select id="SelectOutcomeCount" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM sampleOutcome
        <choose>
            <when test="sample_name != 'none'">
                WHERE sample_name = #{sample_name}
            </when>
        </choose>
    </select>

    <!-- 출고자원 검색 -->
    <select id="SearchOutcome" resultType="SampleOutcome">
        SELECT * FROM sampleOutcome
        <choose>
            <when test="sample_name != 'none'">
                WHERE sample_name = #{sample_name}
                ORDER BY sample_outcome_id DESC
            </when>
        </choose>
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 시교자원 삭제 -->
    <select id="DeleteSample" parameterType="java.util.ArrayList">
        DELETE FROM sample
        WHERE
        <foreach collection="array" item="item" open="(" close=")" separator="OR">
            sample_id = #{item}
        </foreach>
    </select>

    <!-- 수출자원 삭제 -->
    <select id="DeleteOutcome" parameterType="java.util.ArrayList">
        DELETE FROM sampleOutcome
        WHERE
        <foreach collection="array" item="item" open="(" close=")" separator="OR">
            sample_outcome_id = #{item}
        </foreach>
    </select>

    <!-- 시교자원 수정 -->
    <update id="UpdateSample" parameterType="Sample">
        UPDATE sample
        SET ${sample_name} = #{sample_value}
        WHERE sample_id = #{sample_id}
    </update>

    <!-- 수출자원 수정 -->
    <update id="UpdateOutcome" parameterType="SampleOutcome">
        UPDATE sampleOutcome
        SET ${sample_outcome_name} = #{sample_outcome_value}
        WHERE sample_outcome_id = #{sample_outcome_id}
    </update>

    <!-- 시교자원 수정 -->
    <update id="UpdateInsertSample" parameterType="Sample">
        UPDATE sample
        SET sample_code    = #{sample_code},
            sample_name    = #{sample_name},
            sample_country = #{sample_country},
            sample_type    = #{sample_type},
            sample_mate    = #{sample_mate},
            sample_seed    = #{sample_seed},
            sample_amount  = #{sample_amount},
            sample_sprout  = #{sample_sprout},
            sample_purity  = #{sample_purity},
            sample_comment = #{sample_comment},
            modify_date    = NOW()
        WHERE sample_id = #{sample_id}
    </update>

    <!-- 수출자원 수정 -->
    <update id="UpdateInsertOutcome" parameterType="SampleOutcome">
        UPDATE sampleOutcome
        SET sample_outcome_code     = #{sample_outcome_code},
            sample_outcome_num      = #{sample_outcome_num},
            sample_outcome_amount   = #{sample_outcome_amount},
            sample_outcome_in       = #{sample_outcome_in},
            sample_outcome_out      = #{sample_outcome_out},
            sample_outcome_remain   = #{sample_outcome_remain},
            sample_outcome_person   = #{sample_outcome_person},
            sample_outcome_reciever = #{sample_outcome_reciever},
            sample_outcome_date     = #{sample_outcome_date},
            sample_outcome_end      = #{sample_outcome_end},
            sample_outcome_country  = #{sample_outcome_country},
            sample_outcome_place    = #{sample_outcome_place}
        WHERE sample_outcome_id = #{sample_outcome_id}
    </update>

    <!-- 엑셀파일 등록 -->
    <insert id="InsertExcel" parameterType="Sample">
        INSERT INTO sample
        (sample_id, sample_code, sample_name, sample_country, sample_type,
         sample_mate, sample_seed, sample_amount, sample_sprout, sample_purity,
         sample_comment, create_date, modify_date)
        VALUES (#{sample_id}, #{sample_code}, #{sample_name}, #{sample_country}, #{sample_type},
                #{sample_mate}, #{sample_seed}, #{sample_amount}, #{sample_sprout}, #{sample_purity},
                #{sample_comment}, NOW(), NOW())
    </insert>

    <!-- 수출관리 엑셀 등록 -->
    <insert id="InsertOutcomeExcel" parameterType="SampleOutcome">
        INSERT INTO sampleOutcome
        (sample_outcome_id, sample_outcome_code, sample_outcome_num, sample_outcome_amount, sample_outcome_in, sample_outcome_out, sample_outcome_remain, sample_outcome_person,
         sample_outcome_reciever, sample_outcome_date, sample_outcome_end, sample_outcome_country, sample_outcome_place)
        VALUES (#{sample_outcome_id}, #{sample_outcome_code}, #{sample_outcome_num}, #{sample_outcome_amount}, #{sample_outcome_in},
                #{sample_outcome_out}, #{sample_outcome_remain}, #{sample_outcome_person}, #{sample_outcome_reciever}, #{sample_outcome_date},
                #{sample_outcome_end}, #{sample_outcome_country}, #{sample_outcome_place})
    </insert>

    <!-- 첨부파일 조회 -->
    <select id="SelectUploads" parameterType="java.util.ArrayList" resultType="Uploads">
        SELECT * FROM uploads u
        LEFT JOIN sample_file sf ON u.sample_file_id = sf.sample_file_id
        LEFT JOIN sample s ON sf.sample_id = s.sample_id
        WHERE
        <foreach collection="array" item="item" open="(" close=")" separator="OR">
            s.sample_id = #{item}
        </foreach>
    </select>

    <!-- 첨부파일 내용 삭제 -->
    <delete id="DeleteFile" parameterType="java.util.ArrayList">
        DELETE FROM sample_file
        WHERE
        <foreach collection="array" item="item" open="(" close=")" separator="OR">
            sample_id = #{item}
        </foreach>
    </delete>

    <!-- 첨부파일 삭제 -->
    <delete id="DeleteUploads" parameterType="java.util.ArrayList">
        DELETE FROM uploads
        WHERE
        <foreach collection="list" item="item" open="(" close=")" separator="OR">
            uploads_id = #{item.uploads_id}
        </foreach>
    </delete>

    <!-- 첨부파일 목록 조회 -->
    <select id="SelectSampleFile" parameterType="int" resultType="SampleFile">
        SELECT * FROM sample_file sf
        LEFT JOIN uploads u ON sf.sample_file_id = u.sample_file_id
        WHERE sf.sample_id = #{sample_id}
    </select>

    <!-- 첨부파일 내용 등록 -->
    <insert id="InsertSampleFile" parameterType="SampleFile">
        INSERT INTO sample_file
        (sample_id, sample_file_title, sample_file_contents, create_date, modify_date)
        VALUES
        (#{sample_id}, #{sample_file_title}, #{sample_file_contents}, NOW(), NOW())
        <selectKey resultType="int" keyProperty="sample_file_id" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 첨부파일 등록 -->
    <insert id="InsertSampleUpload" parameterType="Uploads">
        INSERT INTO uploads
        (uploads_file, uploads_origin_file, uploads_type, uploads_cat, sample_file_id, create_date, modify_date)
        VALUES (#{uploads_file}, #{uploads_origin_file}, 0, 0, #{sample_file_id}, NOW(), NOW())
    </insert>

    <!-- 첨부파일 내용 수정 -->
    <update id="UpdateSampleFile" parameterType="SampleFile">
        UPDATE sample_file
        SET sample_file_title    = #{sample_file_title},
            sample_file_contents = #{sample_file_contents},
            modify_date         = NOW()
        WHERE sample_file_id = #{sample_file_id}
    </update>

    <!-- 첨부파일 수정 -->
    <update id="UpdateSampleUpload" parameterType="Uploads">
        UPDATE uploads
        SET uploads_file        = #{uploads_file},
            uploads_origin_file = #{uploads_origin_file},
            modify_date         = NOW()
        WHERE sample_file_id = #{sample_file_id}
    </update>
</mapper>
